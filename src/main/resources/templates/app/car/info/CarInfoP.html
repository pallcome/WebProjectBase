<th:block layout:decorate="~{${layoutName}}">
<!-- 페이지 content(ui) -->
<div layout:fragment="pageContent" class="wrapper">
	<div class="main-wrap">
	    <!-- s : main -->
	    <div class="main">
	        <!-- s : 내용 시작 -->
	        <div class="card mb-0">
	            <div class="card-body">
	                <div class="row">
	                    <div class="col-sm">
	                        <!-- e : subtitle-wrap -->
	                        <div class="subtitle-wrap row">
	                            <div class="col-md-6">
	                                <h3 class="card-title">자동차모델 검색</h3>
	                            </div>
	                            <div class="col-md-6">
	                                <div class="text-sm-end">
	                                    <button id="btnSearch" class="btn btn-secondary"><i class="fas fa-search me-2"></i>검색</button>
	                                    <button id="btnSave" type="button" class="btn btn-primary"><i class="fas fa-check me-2"></i>적용</button>
	                                    <button id="btnClose" type="button" class="btn btn-outline-primary">닫기</button>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="row gx-2 mb-3">
	                            <form id="searchForm">
									<div class="table-form">
										<table class="table table-bordered align-middle">
											<colgroup>
												<col width="140">
												<col width="*">
												<col width="140">
												<col width="*">
											</colgroup>
											<tbody>
												<tr>
													<th>
														<label for="SEARCH_MKR_CD" class="col-form-label">제조사</label>
													</th>
													<td>
														<select id="SEARCH_MKR_CD" name="SEARCH_MKR_CD" class="form-select">
					                                        <option value="" >전체</option>
					                                        <option th:each="item : ${carMakerList}" th:value="${item.MKR_CD}" th:text="${item.MKR_NM}" th:attr="data-img=${item.ULD_FILE_NM} != null ? @{/file/image(path=${item.ULD_FILE_NM + '.' + item.FILE_EXTN_NM})} : null"></option>
					                                    </select>
													</td>
													<th>
														<label for="MNFTR_START_YR" class="col-form-label">제조년도</label>
													</th>
													<td>
														<div class="row gx-2 align-items-center">
							                                <div class="col-sm-auto">
							                                    <div class="calendar-item">
							                                        <label for="MNFTR_START_YR"><i class="fa-solid fa-calendar-days"></i></label>
							                                        <input type="text" id="MNFTR_START_YR" name="MNFTR_START_YR" class="calendar-input">
							                                    </div>
							                                </div>
							                                <div class="col-sm-auto">~</div>
							                                <div class="col-sm-auto">
							                                    <div class="calendar-item">
							                                        <label for="MNFTR_END_YR"><i class="fa-solid fa-calendar-days"></i></label>
							                                        <input type="text" id="MNFTR_END_YR" name="MNFTR_END_YR" class="calendar-input">
							                                    </div>
							                                </div>
							                            </div>
													</td>
												</tr>
												<tr>
													<th>
	                                					<label for="SC_CAR_MDL_NM" class="col-form-label">모델명</label>
													</th>
													<td>
														<input type="text" id="SC_CAR_MDL_NM" name="SC_CAR_MDL_NM" class="form-control ">
													</td>
													<th>
														<label for="TEST_YN" class="col-form-label">평가여부</label>
													</th>
													<td>
					                                    <div class="form-check form-check-inline">
				                                            <input class="form-check-input" type="checkbox" name="TEST_YN" id="TEST_YN_Y" value="Y" checked>
				                                            <label class="form-check-label" for="TEST_YN_Y">Y</label>
				                                        </div>
				                                        <div class="form-check form-check-inline">
				                                            <input class="form-check-input" type="checkbox" name="TEST_YN" id="TEST_YN_N" value="N" checked>
				                                            <label class="form-check-label" for="TEST_YN_N">N</label>
				                                        </div>
													</td>
												</tr>
												<tr>
													<th>
														<div class="form-check form-check-inline">
			                                                <input class="form-check-input" type="checkbox" name="SC_CARMDL_1N_CD" id="SC_CARMDL_1N_CD" value="ALL" checked="checked" />
			                                                <label class="form-check-label all-label" for="SC_CARMDL_1N_CD">차종분류1</label>
			                                            </div>
													</th>
													<td colspan="3">
														<th:block th:each="item, state : ${carN1KindList}">
															<div th:with="fieldName='SC_CARMDL_1N_CD'" class="form-check form-check-inline">
																<input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.CARMDL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
																<label th:for="${fieldName + state.index}" th:text="${item.CARMDL_CLSF_NM}" class="form-check-label"></label>
															</div>
														</th:block>
													</td>
												</tr>
												<tr>
													<th>
			                                            <div class="form-check form-check-inline">
			                                                <input class="form-check-input" type="checkbox" name="SC_CARMDL_2N_CD" id="SC_CARMDL_2N_CD" value="ALL" checked="checked">
			                                                <label class="form-check-label all-label" for="SC_CARMDL_2N_CD">차종분류2</label>
			                                            </div>
													</th>
													<td colspan="3">
				                                        <th:block th:each="item, state : ${carN2KindList}">
															<div th:with="fieldName='SC_CARMDL_2N_CD'" class="form-check form-check-inline">
																<input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.CARMDL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
																<label th:for="${fieldName + state.index}" th:text="${item.CARMDL_CLSF_NM}" class="form-check-label"></label>
															</div>
														</th:block>
													</td>
												</tr>
												<tr>
													<th>
			                                            <div class="form-check form-check-inline">
			                                                <input class="form-check-input" type="checkbox" name="SC_FUEL_CD" id="SC_FUEL_CD" value="ALL" checked="checked">
			                                                <label class="form-check-label all-label" for="SC_FUEL_CD">연료</label>
			                                            </div>
													</th>
													<td colspan="3">
				                                        <th:block th:each="item, state : ${carFuelList}">
															<div th:with="fieldName='SC_FUEL_CD'" class="form-check form-check-inline">
																<input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.FUEL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
																<label th:for="${fieldName + state.index}" th:text="${item.FUEL_NM}" class="form-check-label"></label>
															</div>
														</th:block>
													</td>
												</tr>
												<tr>
													<th>
			                                            <div class="form-check form-check-inline">
			                                                <input class="form-check-input" type="checkbox" name="SC_TRSM_CD" id="SC_TRSM_CD" value="ALL" checked="checked">
			                                                <label class="form-check-label all-label" for="SC_TRSM_CD">변속기분류</label>
			                                            </div>
													</th>
													<td colspan="3">
														<th:block th:each="item, state : ${carTransList}">
															<div th:with="fieldName='SC_TRSM_CD'" class="form-check form-check-inline">
																<input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.TRSM_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
																<label th:for="${fieldName + state.index}" th:text="${item.TRSM_NM}" class="form-check-label"></label>
															</div>
														</th:block>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</form>
	                        </div>
	                        <div class="data-table-wrap">
	                        	<table id="MODEL_LIST" class="table table-striped w-100 nowrap"></table>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
</div>
<!-- 페이지 script -->
<th:block layout:fragment="pageScript">
	<script th:inline="javascript">
	const myapp = (function() {
		let myapp = {};
		
		Common.datepicker($("#MNFTR_START_YR"), {
			view : "years"
		});
		Common.datepicker($("#MNFTR_END_YR"), {
			view : "years"
		});
		Common.datepickerRange($("#MNFTR_START_YR"), $("#MNFTR_END_YR"));
		
		$("#SEARCH_MKR_CD").select2({
			templateResult : Common.select2ViewImage
			, templateSelection : Common.select2ViewImage
		});
		
		<!--/* checkbox 이벤트 */-->
		$(":checkbox[name='SC_CARMDL_1N_CD'], :checkbox[name='SC_CARMDL_2N_CD'], :checkbox[name='SC_FUEL_CD'], :checkbox[name='SC_TRSM_CD']").change(function(e) {
			const value = $(this).val();
			const name = $(this).attr("name");
			if(value == "ALL") { <!--/* 전체선택 */-->
				$(`:checkbox[name='${name}']`).prop("checked", $(this).is(":checked"))
			}else {
				const cnt = $(`:checkbox[name='${name}']:not(#${name})`).length;
				const checkedCnt = $(`:checkbox[name='${name}']:not(#${name}):checked`).length;
				$(`:checkbox#${name}`).prop("checked", cnt == checkedCnt);
			}
		});
		
		DataTable.init({
			targetId : "MODEL_LIST"
			, columns : [
				{data : "TEST_YR", title : "시험년도", className : "text-center"}
				, {data : "TEST_YN", title : "평가여부", className : "text-center"}
				, {data : "MKR_NM", title : "제조사", className : "text-start"}
				, {data : "CAR_MDL_NM", title : "모델명", className : "text-start"}
				, {data : "CARMDL_1N_NM", title : "차종분류1", className : "text-start"}
				, {data : "CARMDL_2N_NM", title : "차종분류2", className : "text-start"}
				, {data : "FUEL_NM", title : "연료", className : "text-start"}
				, {data : "MNFTR_YR", title : "제조년도", className : "text-center"}
				, {data : "TRSM_NM", title : "변속기분류", className : "text-start"}
			]
			, visibleRowNo : true
			, checkedRows : true
			, rowSelectCallback : function(e) {
			}
		});
		
		<!--/* 목록 조회 */-->
		myapp.search = function() {
			Common.ajax({
				url : /*[[@{/car/info/edit/selectList}]]*/
				, data : $("#searchForm").serializeObject()
				, callback : function(result, textStatus, jqXHR) {
					DataTable.setRows({rows : result}, "MODEL_LIST");
				}
			});
		}
		myapp.search();
		
		<!--/* 검색 버튼 클릭 이벤트 */-->
		$("#btnSearch").on("click", function() {
			myapp.search();
		});
		
		<!--/* input 엔터 이벤트 */-->
		$("#searchForm :input").keypress(function(e) {
			if(e.keyCode == 13) {
				myapp.search();
			}
		});
		
		<!--/* 닫기 */-->
		$("#btnClose").on("click", function() {
			window.close();
		});
		
		<!--/* 적용버튼 클릭시 */-->
		$("#btnSave").on("click", function() {
			let list = DataTable.getSelectedRows("MODEL_LIST");
			if(list.length === 0){
				Common.alert({
					msg : '선택된 데이터가 없습니다.'
				});
				return;
			}
			opener.Popup.closeCallback(/*[[${id}]]*/, DataTable.getSelectedRows());
		});
		
		return myapp;
	}());
	</script>
</th:block>
</th:block>