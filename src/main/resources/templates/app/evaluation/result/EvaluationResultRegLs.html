<th:block layout:decorate="~{${layoutName}}">
<!-- 페이지 content(ui) -->
<main layout:fragment="pageContent" class="content">
	<div class="container-fluid p-0">
		<!-- s : 내용 시작 -->
		<div class="row align-items-center content-head">
			<div class="col-md-6">
				<h2 class="h1 mb-0 col-md-auto">대상 차량 평가 결과 등록</h2>
			</div>
			<div class="col-md-6">
				<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
					<ol class="breadcrumb mb-0 justify-content-end">
						<li class="breadcrumb-item" aria-current="page"><i
								class="fas fa-home me-1"></i>홈</li>
						<li class="breadcrumb-item" aria-current="page">평가 결과 정보</li>
						<li class="breadcrumb-item" aria-current="page">대상 차량 평가 결과 등록</li>
					</ol>
				</nav>
			</div>
		</div>
		<div class="card">
			<div class="card-body">
				<!-- e : subtitle-wrap -->
				<div class="subtitle-wrap row">
					<div class="col-md-6">
						<h3 class="card-title">대상 차량</h3>
					</div>
					<div class="col-md-6">
						<div class="text-sm-end">
							<button type="button" id="btnSearch" class="btn btn-secondary"><i class="fas fa-search me-2"></i>검색</button>
						</div>
					</div>
				</div>
				<form id="searchForm">
					<div class="table-form">
					  <table class="table table-bordered align-middle">
					    <colgroup>
					      <col width="130">
					      <col width="*">
					      <col width="130">
					      <col width="*">
					      <col width="130">
					      <col width="*">
					    </colgroup>
					    <tbody>
					      <tr>
					        <th><label for="TEST_YR" class="col-form-label required">시험년도</label></th>
					        <td > 
					          <select id="TEST_YR" name="TEST_YR" class="form-select" required>
					            <option value="">선택</option>
					            <option th:each="item : ${testYearList}" th:value="${item.TEST_YR}" th:text="${item.TEST_YR}"></option>
					          </select>
					        </td>
					        <th><label for="TEST_RESULT_YN" class="col-form-label">평가여부</label></th>
					        <td>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="TEST_RESULT_YN" id="TEST_RESULT_Y" value="Y" checked>
					            <label class="form-check-label" for="TEST_RESULT_Y">Y</label>
					          </div>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="TEST_RESULT_YN" id="TEST_RESULT_N" value="N" checked>
					            <label class="form-check-label" for="TEST_RESULT_N">N</label>
					          </div>
					        </td>
					        <th><label class="col-form-label">제조년도</label></th>
					        <td>
					          <div class="row gx-2 align-items-center">
					            <div class="col-sm-auto">
					              <div class="calendar-item">
					                <label for="MNFTR_START_YR"><i class="fa-solid fa-calendar-days"></i></label>
					                <input type="text" id="MNFTR_START_YR" name="MNFTR_START_YR" class="calendar-input">
					              </div>
					            </div>
					            <div class="col-sm-auto">~</div>
					            <div class="col-sm-auto">
					              <div class="calendar-item">
					                <label for="MNFTR_END_YR"><i class="fa-solid fa-calendar-days"></i></label>
					                <input type="text" id="MNFTR_END_YR" name="MNFTR_END_YR" class="calendar-input">
					              </div>
					            </div>
					          </div>
					        </td>
					      </tr>
					      <tr>
					        <th><label for="MKR_CD" class="col-form-label">제조사</label></th>
					        <td>
					          <select id="MKR_CD" name="MKR_CD" class="form-select">
					            <option value="">전체</option>
					            <option th:each="item : ${mkrCdList}" th:value="${item.MKR_CD}" th:text="${item.MKR_NM}" th:attr="data-img=${item.ULD_FILE_NM} != null ? @{/file/image(path=${item.ULD_FILE_NM + '.' + item.FILE_EXTN_NM})} : null"></option>
					          </select>
					        </td>
					        <th><label for="CAR_MDL_NM" class="col-form-label">모델명</label></th>
					        <td>
					          <input type="text" id="CAR_MDL_NM" name="CAR_MDL_NM" class="form-control">
					        </td>
					        <th><label for="TEST_RSLT_RLS_YN" class="col-form-label">결과 공개여부</label></th>
					        <td>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="TEST_RSLT_RLS_YN" id="TEST_RSLT_RLS_Y" value="Y" checked>
					            <label class="form-check-label" for="TEST_RSLT_RLS_Y">공개</label>
					          </div>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="TEST_RSLT_RLS_YN" id="TEST_RSLT_RLS_N" value="N" checked>
					            <label class="form-check-label" for="TEST_RSLT_RLS_N">비공개</label>
					          </div>
					        </td>
					      </tr>
					      <tr>
					        <th>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="CARMDL_1N_CD" id="CARMDL_1N_CD" value="ALL" checked>
					            <label class="form-check-label all-label" for="CARMDL_1N_CD">차종분류1</label>
					          </div>
					        </th>
					        <td colspan="5">
					          <th:block th:each="item, state : ${clsfSeCd1List}">
					            <div th:with="fieldName='CARMDL_1N_CD'" class="form-check form-check-inline">
					              <input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.CARMDL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
					              <label th:for="${fieldName + state.index}" th:text="${item.CARMDL_CLSF_NM}" class="form-check-label"></label>
					            </div>
					          </th:block>
					        </td>
					      </tr>
					      <tr>
					        <th>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="CARMDL_2N_CD" id="CARMDL_2N_CD" value="ALL" checked>
					            <label class="form-check-label all-label" for="CARMDL_2N_CD">차종분류2</label>
					          </div>
					        </th>
					        <td colspan="5">
					          <th:block th:each="item, state : ${clsfSeCd2List}">
					            <div th:with="fieldName='CARMDL_2N_CD'" class="form-check form-check-inline">
					              <input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.CARMDL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
					              <label th:for="${fieldName + state.index}" th:text="${item.CARMDL_CLSF_NM}" class="form-check-label"></label>
					            </div>
					          </th:block>
					        </td>
					      </tr>
					
					      <tr>
					        <th>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="FUEL_CD" id="FUEL_CD" value="ALL" checked>
					            <label class="form-check-label all-label" for="FUEL_CD">연료</label>
					          </div>
					        </th>
					        <td colspan="5">
					          <th:block th:each="item, state : ${fuelCdList}">
					            <div th:with="fieldName='FUEL_CD'" class="form-check form-check-inline">
					              <input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.FUEL_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
					              <label th:for="${fieldName + state.index}" th:text="${item.FUEL_NM}" class="form-check-label"></label>
					            </div>
					          </th:block>
					        </td>
					      </tr>
					      <tr>
					        <th>
					          <div class="form-check form-check-inline">
					            <input class="form-check-input" type="checkbox" name="TRSM_CD" id="TRSM_CD" value="ALL" checked>
					            <label class="form-check-label all-label" for="TRSM_CD">변속기</label>
					          </div>
					        </th>
					        <td colspan="5">
					          <th:block th:each="item, state : ${trsmCdList}">
					            <div th:with="fieldName='TRSM_CD'" class="form-check form-check-inline">
					              <input th:name="${fieldName}" th:id="${fieldName + state.index}" th:value="${item.TRSM_CD}" th:validLabel="${fieldName}" class="form-check-input" type="checkbox" checked>
					              <label th:for="${fieldName + state.index}" th:text="${item.TRSM_NM}" class="form-check-label"></label>
					            </div>
					          </th:block>
					        </td>
					      </tr>
					    </tbody>
					  </table>
					</div>
				</form>
				<div class="data-table-wrap">
					<table id="list" class="table table-striped w-100 nowrap"></table>
				</div>
				<!-- e : data-table-wrap -->
			</div>
		</div>
		
		<!-- e : 내용 끝 -->
	</div>
</main>
<!-- 페이지 script -->
<th:block layout:fragment="pageScript">
<script th:inline="javascript">
const  myapp = (function() {
	const myapp = {};
	
	<!--/************ Form 설정 ************/-->
	$("select:not(#MKR_CD)").select2();
	$("#MKR_CD").select2({
		templateResult : Common.select2ViewImage
		, templateSelection : Common.select2ViewImage
	});
	
	Common.datepicker($("#MNFTR_START_YR"), {
		view : "years"
	});
	Common.datepicker($("#MNFTR_END_YR"), {
		view : "years"
	});
	Common.datepickerRange($("#MNFTR_START_YR"), $("#MNFTR_END_YR"));
	
	<!--/************ DataTable 선언 ************/-->
	DataTable.init({
		targetId : "list"
		, columns : [
			{data : "TEST_RSLT_RLS_YN", title : "결과공개여부", width : "60px", className : "text-center"
				, render : function(data, type, rowData, meta) {
					if(data) {
						return data == "Y" ? "공개" : "미공개";
					}
					return "";
				}
			}
			, {data : "TEST_RESULT_YN", title : "평가여부", width : "60px", className : "text-center"}
			, {data : "TOT_TEST_GRD", title : "종합등급", width : "60px", className : "text-center"}
			, {data : "GHG_TEST_GRD", title : "연비·온실가스 등급", width : "60px", className : "text-center"}
			, {data : "LCA_TEST_GRD", title : "LCA 전생애주기 온실가스 등급", width : "60px", className : "text-center"}
			, {data : "AIR_TEST_GRD", title : "차실내공기질 등급", width : "60px", className : "text-center"}
			, {data : "MKR_NM", title : "제조사", width : "60px", className : "text-center"}
			, {data : "CAR_MDL_NM", title : "모델명", width : "150px", className : "text-start cell-select"}
			, {data : "CARMDL_1N_NM", title : "차종분류1", width : "60px", className : "text-center"}
			, {data : "CARMDL_2N_NM", title : "차종분류2", width : "60px", className : "text-center"}
			, {data : "FUEL_NM", title : "연료", width : "60px", className : "text-center"}
			, {data : "TRSM_NM", title : "변속기", width : "60px", className : "text-center"}
			, {data : "MNFTR_YR", title : "제조년도", width : "60px", className : "text-center"}
		]
		, visibleRowNo : true
		, buttons : [
			{
				type : "excel"
				, fileName : "대상 차량 평가 결과 등록 목록"
			}
		]
		, cellClick : function(rowData, row) {
			let selectedData = DataTable.getSelectedRows();
			const url = /*[[@{/evaluation/result/reg/edit}]]*/
			location.href = `${url}?id=${rowData.CAR_MDL_CD}`;
		}
	});
	<!--/* 목록 조회 */-->
	myapp.search = function() {
		const formValid = Common.valid($("#searchForm"));
		
		if(!formValid.valid) {
			Common.showValidDialog([formValid]);
			return;
		}
		
		Common.ajax({
			url : /*[[@{/evaluation/result/reg/selectList}]]*/
			, data : $("#searchForm").serializeObject()
			, callback : function(result, textStatus, jqXHR) {
				DataTable.setRows({rows : result}, "list");
			}
		});
	}
	
	<!--/************ Form Event 선언 ************/-->
	<!--/* 검색 버튼 클릭 이벤트 */-->
	$("#btnSearch").on("click", function() {
		myapp.search();
	});
	<!--/* input 엔터 이벤트 */-->
	$("#searchForm :input").keypress(function(e) {
		if(e.keyCode == 13) {
			myapp.search();
		}
	});
	<!--/* checkbox 이벤트 */-->
	$(":checkbox[name='CARMDL_1N_CD'], :checkbox[name='CARMDL_2N_CD'], :checkbox[name='FUEL_CD'], :checkbox[name='TRSM_CD']").change(function(e) {
		const value = $(this).val();
		const name = $(this).attr("name");
		if(value == "ALL") { <!--/* 전체선택 */-->
			$(`:checkbox[name='${name}']`).prop("checked", $(this).is(":checked"))
		}else {
			const cnt = $(`:checkbox[name='${name}']:not(#${name})`).length;
			const checkedCnt = $(`:checkbox[name='${name}']:not(#${name}):checked`).length;
			
			$(`:checkbox#${name}`).prop("checked", cnt == checkedCnt);
		}
	});
	
	<!--/************ window 함수 선언 ************/-->
	$(window).resize(function() {
		DataTable.dataTableResize(); <!--/* DataTables resize */-->
	});
		
	return myapp;
}());
</script>
</th:block>
</th:block>